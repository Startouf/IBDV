<!doctype html>
<html>
  <head>
    <title>Globe and meteors impacts</title>
    <meta charset="utf-8">
    <link  href="css/main.css" rel="stylesheet"/>
  </head>
<body>
    
  <div id="container"></div>

  <script src="./javascript/three.min.js"></script>
    <script src="./js/jQuery.min.js"></script>
	<script src="./js/meteorite_parser.js"></script>

  
  <script type="text/javascript">   
   
   

    var POS_X = 1800;
    var POS_Y = 500;
    var POS_Z = 1800;
    var WIDTH = 1000;
    var HEIGHT = 600;
 
    var FOV = 45;
    var NEAR = 1;
    var FAR = 4000;
	
	var radius= 600;
 
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(WIDTH,HEIGHT);
    renderer.setClearColorHex(0x111111);
 
    var mapDiv = document.getElementById("container");
    mapDiv.appendChild(renderer.domElement);
 
 
    var camera = new THREE.PerspectiveCamera(FOV,WIDTH/HEIGHT,NEAR,FAR);
    camera.position.set(POS_X,POS_Y, POS_Z);
    camera.lookAt(new THREE.Vector3(0,0,0));
 

    var scene = new THREE.Scene();
    scene.add(camera);
	
    addSphere();
	addLights();
	render();
	animate();
 

      /*  jQuery.get('data/meteors.xlsx', function(data) {
            //addDensity(CSVToArray(data));
            addLights();
            addSphere();
            //addClouds();
            render();
        });
    }); */
	
	
	
	function addSphere() {
        var sphere = new THREE.SphereGeometry(radius,50,50);
		var material = new THREE.MeshBasicMaterial( { map: THREE.ImageUtils.loadTexture('map.jpg', new THREE.SphericalReflectionMapping()), overdraw: true } );		 
			 
        mesh = new THREE.Mesh(sphere,material);
        scene.add(mesh);
		render();
		}
		
    function addLights() {
        light = new THREE.DirectionalLight(0x3333ee, 3.5, 500 );
		light = new THREE.DirectionalLight(0x000000, 3.5, 500 );
        scene.add( light );
        light.position.set(POS_X,POS_Y,POS_Z);
    }
	
	function render() {
		renderer.render(scene, camera);
	}
	
	function animate(){
    requestAnimationFrame( animate );
    mesh.rotation.y += 0.003;
	//mesh.position.y -= 0.5;
    render();
}

	function displayStuff() {
	
	
	
        // the geometry that will contain all our cubes
        var geom = new THREE.Geometry();
        // material to use for each of our elements. Could use a set of materials to
        // add colors relative to the density. Not done here.
        var cubeMat = new THREE.MeshLambertMaterial({color: 0x000000,opacity:0.6, emissive:0xffffff});
        for (var i = 0 ; i < dataset.length-1 ; i++) {
 
 
 
            //get the data, and set the offset, we need to do this since the x,y coordinates
            //from the data aren't in the correct format
            var latitude = dataset[i].latitude;
            var longitude = dataset[i].longitude;

 
            // calculate the position where we need to start the cube
            var position = createVector(latitude, longitude, 600, 2);
 
            // create the cube
            var cube = new THREE.Mesh(new THREE.CubeGeometry(5,5,1+value/8,1,1,1,cubeMat));
 
            // position the cube correctly
            cube.position = position;
            cube.lookAt( new THREE.Vector3(0,0,0) );
 
            // merge with main model
            THREE.GeometryUtils.merge(geom,cube);
        }
 
        // create a new mesh, containing all the other meshes.
        var total = new THREE.Mesh(geom,new THREE.MeshFaceMaterial());
 
        // and add the total mesh to the scene
        scene.add(total);
	
	}

	function createVector(lat, lon, radius, height) {
        var phi = (lat)*Math.PI/180;
        var theta = (lon-180)*Math.PI/180;
 
        var x = -(radius+height) * Math.cos(phi) * Math.cos(theta);
        var y = (radius+height) * Math.sin(phi);
        var z = (radius+height) * Math.cos(phi) * Math.sin(theta);
	
        return new THREE.Vector3(x,y,z);
		
		}


	
  </script>
</body>
</html>